<!DOCTYPE html>
<html>
    <head>
        <title>Santiago</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="https://bradylab.ucsd.edu/turk/experiments/Janna/Santiago/jspsych/dist/jspsych.js"></script>
        <script src="https://bradylab.ucsd.edu/turk/experiments/Janna/Santiago/jspsych/dist/plugin-instructions.js"></script>
        <script src="https://bradylab.ucsd.edu/turk/experiments/Janna/Santiago/jspsych/dist/plugin-html-button-response.js"></script>
        <script src="https://bradylab.ucsd.edu/turk/experiments/Janna/Santiago/jspsych/dist/plugin-survey-text.js"></script>
        <script src="https://bradylab.ucsd.edu/turk/experiments/Janna/Santiago/jspsych/dist/homemade/plugin-continuous-ori-retrocue-v2.js"></script>
        <link rel="stylesheet" href="https://bradylab.ucsd.edu/turk/experiments/Janna/Santiago/jspsych/dist/jspsych.css">
    </head>

<body></body>
<script>
    /* Require a new-ish browser: 
------------------------------------------ */
    function supportsLiterals() {
        try { return eval("''===``") }
        catch(e) { return false; }
    }
    if (!supportsLiterals()) {
        var txt = "Sorry, this experiment requires a newer browser, so yours is not able to be used. The latest Chrome, Firefox, Safari or Edge all work.";
        alert(txt); 
        document.body.onload = function() { document.body.innerHTML = txt; };
    }
    
    var jsPsych = initJsPsych({
        show_progress_bar: true,
        auto_update_progress_bar: false
    });

    // capture info from Prolific
    /*
    var subject_id = jsPsych.data.getURLVariable('PROLIFIC_PID');
    var study_id = jsPsych.data.getURLVariable('STUDY_ID');
    var session_id = jsPsych.data.getURLVariable('SESSION_ID');
    
    jsPsych.data.addProperties({
    subject_id: subject_id,
    study_id: study_id,
    session_id: session_id
    });
    */
    // initializing things and getting subj id's
    
    var sona_id = jsPsych.data.urlVariables()['sona_id'];
    const rand_id = Math.round(Math.random()*10000);
    const subject_id = "santiago_" + rand_id + "37";

    jsPsych.data.addProperties({
        sona_id: sona_id,
        subject_id: subject_id,
    });
    
    var num_practice_trials = 8;
    var num_trials = 150;

    var santiago_timeline = []; // instantiate timeline
    
    /* Instructions 
    ------------------------------------------ */
    
    santiago_timeline.push({
	    type: jsPsychInstructions,
	    pages: ['<p>Welcome to the experiment!</p>',
        '<p>In this experiment, you will have to remember some briefly presented oriented lines. You will need to do <strong>150</strong> trials (plus 8 practice trials), each of which takes about 3-5 seconds. It should take less than 50 minutes total. <strong>Please do not participate if you do not have normal or corrected-to-normal vision.</strong> </p><p>On each trial you will see 4 circles:</p><p align="center"><img src="instruction_screenshots/placeholders.png" width="400" border=0></p>	<p>When you click to start the trial, these circles will fill in with oriented bars. The stimuli will be presented only very briefly &mdash; shown for just 750 milliseconds (less than one second!) &mdash; so be sure not to click to start the trial until you are ready. <strong>Your job is to remember which exact orientation is in each location as best you can.</strong></p><p align="center"><img src="instruction_screenshots/oris.png" width="400" border=0></p><p>We are interested in your <b>VISUAL</b> memory. So it is important that you do not say the names of the angles to yourself or use words to perform the task. If you find yourself struggling not to do this, we suggest you repeat the word "the" over and over in your head when the items are presented. This will help you to remember not to use words to remember the orientations.</p> <p>On all trials, you will be shown 4 stimuli. After the stimuli are initially presented, there will be a "cue" period, during which either all 4 of the circles will have a darker border, or just two of them will. <p align="center"><img src="instruction_screenshots/retrocue_four_items.png" width="400" border=0><img src="instruction_screenshots/retrocue_two_items.png" width="400" border=0></p> If all 4 circles have a dark border, this means you will be tested on one of those four items. However, if just two of the circles do, this means you will only be tested on one of those two, so you can "drop" the other two items from your memory. Please do your best to use the information given by the cues throughout the task, as it may be helpful.</p> <p>After the cues disappear, you will be almost immediately tested on your memory. There will be a black wheel around the item whose orientation you need to report. Click the location on the wheel that best matches the angle of the item (you may click either side of the wheel):</p> <p align="center"><img src="instruction_screenshots/example_vertical.png" width="800" border=0></p><p>For example, in this case, since the leftmost circle originally had a vertical (or up and down) bar, you would click as closely to the top or bottom of the report wheel (shown by the red circles).</p><p>Here is another example. In this case, the bottom circle was probed. Click as close as you can to match the original angle of the bar (shown by the red circles).</p><p align="center"><img src="instruction_screenshots/example_diagonal.png" width="800" border=0></p>', 
            
        '<p>In sum, you will see four oriented bars. Then, after a brief delay, either all of the items will be retrocued (meaning, do not drop any), or two of the items will (meaning, drop the non-cued items). Then, after another brief delay, you will be asked to report the orientation of the item.<p align="center"><img src="instruction_screenshots/trial_schema_ori_v2.png" width="800" border=0></p>',

        '<p>To start off with, we will give you <strong>8 practice trials</strong> &mdash; 4 trials with all four items retro-cued and 4 trials with two items retro-cued. Then you will need to do <strong>150</strong> trials of the main task.</p><p text-align="left">Before beginning, you must give informed consent. Please read the following and indicate your agreement by continuing to the next page to start the practice trials:</p> <div id="consentDiv"><p><u>Consent to Act as a Research Subject:</u></p><p style="text-align:left">Dr. John Serences is conducting a research study to learn more about how attention affects how you see things (perception) and how you make simple decisions. There will be approximately 5,000 participants in the study over the next 10 years.</p><p style="text-align:left">PROCEDURES. If you agree to be in this study by clicking NEXT and continuing to this task, the following will happen to you: You will be presented with stimuli that consist of simple shapes presented on a computer screen. You will respond with button presses and/or using your computer mouse.</p> <p style="text-align:left">RISKS. You will be required only to continue to interact with your web browser and make responses for a short duration. Thus, no potential risks or discomforts are anticipated except for the possibility that some tasks may be slightly boring. However, there may be risks that are currently unforeseeable.</p> <p style="text-align:left">REMUNERATION. In consideration of your time and effort you will receive SONA credit for your participation (0.5 credits for 30 minutes).</p><p style="text-align:left">RIGHTS.  If you are injured as a direct result of participation in this research, the University of California will provide any medical care you need to treat those injuries. The University will not provide any other form of compensation to you if you are injured. You may call the Human Research Protections Program at 858-246- 4777 for more information about this, to inquire about your rights as a research subject, or to report research- related problems.</p><p style="text-align:left">BENEFITS.  There will not be any direct benefit to you from these procedures. The investigator, however, may learn more about how human beings pay attention and how this ability affects perception and decision making. </p><p style="text-align:left">EXPLANATION.  Dr. John Serences or a member of his research team has explained this study to you and answered your questions. If you have other questions or research-related problems, you may reach him at 858- 534-3686.</p><p style="text-align:left">VOLUNTARY NATURE OF PARTICIPATION.  Participation in this research is entirely voluntary. There is no cost to you for participating. The alternative to participating is not participating. You may refuse to participate or you may withdraw at any time without jeopardy to the medical care you will receive at this institution, without loss of any access to the care to which you are entitled, or loss of the benefits to which you are entitled. You may also be withdrawn from the study if the investigator feels it is in your best interest or for other study-related purposes. If you wish to withdraw from the study tell a member of the study staff and the testing session will terminate immediately. You will be compensated for the time you have spent.</p><p style="text-align:left">CONFIDENTIALITY.  Research records will be kept confidential to the extent provided by law. Research records will only be accessible by Dr Serences and his research team, and by the UCSD Institutional Review Board. You have received a copy of this consent document. </p><p style="text-align:left">By clicking NEXT, you are indicating that you are at least 18 years old, have read this consent form and agree to participate in this research study. Please print a copy of this page for your records.</p></div>'],
        show_clickable_nav: true
    })
    
    var practice_trials = {
        timeline: [
            {
                type: jsPsychContinuousOriRetrocue,
                data: {is_practice: 'yes'},
                num_placeholders: 4,
                set_size: 4,
                retrocue_set_size: jsPsych.timelineVariable('retrocue_set_size'),
                pre_retrocue_delay: 750,
                retrocue_time: 500,
                post_retrocue_delay: 1000,
                feedback: true,
            }
        ],
        timeline_variables: [
            {retrocue_set_size: 2},
            {retrocue_set_size: 4}
        ],
        randomize_order: true,
        repetitions: num_practice_trials/2,
    }

    
    
    santiago_timeline.push(practice_trials);
    
    santiago_timeline.push({
        type: jsPsychInstructions,
        pages: ['<p align="center">You have completed the practice, and the main task will be the same. Press "Next" to proceed.</p>'],
        show_clickable_nav: true
    })
    
    
    var trial_count = 0;
    var updateCounter = () => {
        trial_count = trial_count+1;
        jsPsych.setProgressBar(trial_count/num_trials);
    }
    
    var trials = {
        timeline: [
            {
                type: jsPsychContinuousOriRetrocue,
                data: {is_practice: 'no'},
                num_placeholders: 4,
                set_size: 4,
                retrocue_set_size: jsPsych.timelineVariable('retrocue_set_size'),
                pre_retrocue_delay: 750,
                retrocue_time: 500,
                post_retrocue_delay: 1000,
                feedback: true,
                on_finish: updateCounter,
            }
        ],
        timeline_variables: [
            {retrocue_set_size: 2},
            {retrocue_set_size: 4}
        ],
        randomize_order: true,
        repetitions: num_trials/2,
    }
    
    santiago_timeline.push(trials);
    santiago_timeline.push({
	    type: jsPsychSurveyText,
	    preamble: "Thank you! You're just about done. If you would, please tell us about yourself:",
	    questions: [
		    {prompt: "How old are you?", name: 'age', rows: 1, columns: 5}, 
		    {prompt: "Gender:", name: 'gender', rows: 1, columns: 40},
            {prompt: "Did you find yourself using the cue (indicating 2 items vs 4 items)? Your answer will NOT affect participation/credit.",
                     name: 'retrocue', rows: 3, columns: 40},
		    {prompt: "Any comments? Was it fun? Any technical difficulties?:", name: 'comments', rows: 3, columns: 40}
	    ],
	    button_label: "Submit", 
        on_finish: function() {SendToServer()}
});

santiago_timeline.push({
	    type: jsPsychInstructions,
	    pages: ['<p>Thank you! You are all done. Press "Next" to be taken back to SONA.</p>'],
        show_clickable_nav: true,
        on_finish: function(){ 
            //window.location.assign("https://app.prolific.co/submissions/complete?cc=CEOGMQK9");
            window.location.assign("https://ucsd.sona-systems.com/webstudy_credit.aspx?experiment_id=2363&credit_token=1f1d5a38a71a4addb8a94508402261c2&survey_code="+sona_id)
    },
});

jsPsych.run(santiago_timeline);   

/* save data to the server */
/* Send the data to the server as JSON: */
var SendToServer = () => {
    console.log('saving data');
    expt_data = { 
		"curTime": jsPsych.getStartTime(),
        "sub_id": subject_id,
		"userAgent": navigator.userAgent,
		"windowWidth": window.innerWidth,
		"windowHeight": window.innerHeight,
		"screenWidth": screen.width,
		"screenHeight": screen.height,   
		"totalTime": jsPsych.getTotalTime(),    
		"interactionData": jsPsych.data.getInteractionData().json(),
		"fullData": jsPsych.data.get().json(),
        "surveyData": jsPsych.data.get().select('response'),

        "rt": jsPsych.data.get().select('rt'),
        "position_of_items": jsPsych.data.get().select('position_of_items'),
        "item_angles": jsPsych.data.get().select('item_angles'),
        "probe_angle": jsPsych.data.get().select('probe_angle'),
        "reported_angle": jsPsych.data.get().select('reported_angle'),
        "reported_angle_wrapped": jsPsych.data.get().select("reported_angle_wrapped"),
        "trial_error": jsPsych.data.get().select('trial_error'),
        "probe_position": jsPsych.data.get().select('probe_pos'),
        "set_size": jsPsych.data.get().select('set_size'),
        "retrocue_set_size": jsPsych.data.get().select('retrocue_set_size'),
        "is_practice": jsPsych.data.get().select('is_practice'),
        "post_retrocue_delay": jsPsych.data.get().select('post_retrocue_delay'),
        "actual_stim_duration": jsPsych.data.get().select('actual_stim_duration')
	};
  var dataToServer = {
    'id': subject_id,
    'experimenter': 'Janna',
    'experimentName': 'Santiago_Ori_v2_SONA',
    'curData': JSON.stringify(expt_data)
  };
  $.post("https://bradylab.ucsd.edu/turk/save.php", dataToServer)
}

 
</script>
</html>